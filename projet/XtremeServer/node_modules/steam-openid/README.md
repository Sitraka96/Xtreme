# Steam OpenID Web Login

# Installation

It's _so_ easy!

```
npm i steam-openid
```

## Version Support

Support for versions of node.js will follow that of the [request](https://www.npmjs.com/package/request) module.

# Usage

```js
import SteamOpenID from "steam-openid";
import SteamCommunity from "steamcommunity";

const openid = new SteamOpenID();
const community = new SteamCommunity();

community.login(
  {
    accountName: "username",
    password: "password",
    disableMobile: true
  },
  (error, sessionID, cookies) => {
    if (error) throw error;
    openid.setCookies(cookies);
  }
);

// openid.loginWeb("https://steamcommunity.com/openid/login?openid.mode=checkid_setup&...")
openid
  .loginWeb("https://csgo500.com/steam/preauth")
  .then(response => console.log(response.body, response.headers, response.href, response.cookies, response.jar))
  .catch(console.error);
```

```js
import SteamOpenID from "steam-openid";

const cookies = ["steamLoginSecure=76561198036081043%7C%7C0BF6C9BA765B006800DE2319B920A5371063F0CC", "sessionid=290eb6ead617308c28811463"];
openid.setCookies(cookies);

openid
  .loginWeb("https://csgo500.com/steam/preauth")
  .then(({ cookies }) => console.log(cookies))
  .catch(console.error);
```

# Methods

### constructor([options])

- `options` - Optional. [request options](https://npmjs.com/package/request#requestoptions-callback)

### setCookies(cookies)

- `cookies` - An array of cookies (as name=value pair strings)

[node-steamcommunity cookies logic](https://github.com/DoctorMcKay/node-steamcommunity/wiki/SteamCommunity#setcookiescookies)

### loginWeb(uri, [cloneJar])

- `uri` - Fully qualified uri [or a parsed url object from url.parse()](https://npmjs.com/package/request#requestoptions-callback), can be a link that will redirect to [https://steamcommunity.com/openid/login?openid.mode=checkid_setup&...](https://steamcommunity.com/openid/login?openid.mode=checkid_setup&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.ns.sreg=http%3A%2F%2Fopenid.net%2Fextensions%2Fsreg%2F1.1&openid.sreg.optional=nickname%2Cemail%2Cfullname%2Cdob%2Cgender%2Cpostcode%2Ccountry%2Clanguage%2Ctimezone&openid.ns.ax=http%3A%2F%2Fopenid.net%2Fsrv%2Fax%2F1.0&openid.ax.mode=fetch_request&openid.ax.type.fullname=http%3A%2F%2Faxschema.org%2FnamePerson&openid.ax.type.firstname=http%3A%2F%2Faxschema.org%2FnamePerson%2Ffirst&openid.ax.type.lastname=http%3A%2F%2Faxschema.org%2FnamePerson%2Flast&openid.ax.type.email=http%3A%2F%2Faxschema.org%2Fcontact%2Femail&openid.ax.required=fullname%2Cfirstname%2Clastname%2Cemail&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select) like `https://csgo500.com/steam/preauth`

- `cloneJar` - Optional. By default(`true`) will use a copy of `.jar` to prevent crossing cookies

**Returns**

```js
{
  body: String,
  headers: String[],
  href: String,
  jar: RequestJar,
  cookies: Object
}
```

_It's better not to use jar instance due to crossing cookies_

_`{ cookies }` includes cookies from Steam domains only if `cloneJar` is `false`_

### getLoginForm(uri, jar)

- `uri` - Check the usage of `.loginWeb(uri, ...)`

- `jar` - [RequestJar](https://www.npmjs.com/package/request#requestjar) with Steam cookies

**Returns**

```js
{
  uri: String,
  data: Object
}
```

_It's better to use `.loginWeb(...)`_

### processLoginForm(uri, formData, jar)

- `uri` - It must be https://steamcommunity.com/openid/login, however Steam can change it in future

- `formData` - Serialized [form](https://www.npmjs.com/package/request#forms) `#loginForm`

- `jar` - [RequestJar](https://www.npmjs.com/package/request#requestjar) with Steam cookies

**Returns**

```js
{
  body: String,
  headers: String[],
  href: String,
}
```

_It's better to use `.loginWeb(...)`_

# Development

- `npm run clean` - Remove `lib` directory

- `npm run test` - Run tests

- `npm run build` - Babel will transpile ES6 => ES5 and minify the code.

- `npm run prepare` - Hook for npm. Do all the checks before publishing module.

# License

Released under [MIT license][]

[mit license]: http://AlexOwl.mit-license.org/
